{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lepha\\\\Desktop\\\\CNPM-Project\\\\QuanLyThuVien_Web\\\\src\\\\pages\\\\BorrowManagement.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { FaPlus, FaSearch, FaEdit, FaTrash, FaCheck, FaTimes } from \"react-icons/fa\";\nimport BorrowModal from \"../components/BorrowModal\";\nimport \"./BorrowManagement.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BorrowManagement = () => {\n  _s();\n  const [borrows, setBorrows] = useState([]);\n  const [filteredBorrows, setFilteredBorrows] = useState([]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showModal, setShowModal] = useState(false);\n  const [editingBorrow, setEditingBorrow] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const apiUrl = \"http://localhost:5280/api/PhieuMuon\";\n  const mapBorrowData = borrow => {\n    var _borrow$docGia, _borrow$sach;\n    return {\n      id: borrow.id,\n      readerId: borrow.idDocGia,\n      readerName: ((_borrow$docGia = borrow.docGia) === null || _borrow$docGia === void 0 ? void 0 : _borrow$docGia.tenDocGia) || borrow.tenDocGia || \"\",\n      bookId: borrow.idSach,\n      bookTitle: ((_borrow$sach = borrow.sach) === null || _borrow$sach === void 0 ? void 0 : _borrow$sach.tenSach) || borrow.tenSach || \"\",\n      borrowDate: new Date(borrow.ngayMuon).toISOString().split(\"T\")[0],\n      returnDate: new Date(borrow.hanTra).toISOString().split(\"T\")[0],\n      actualReturnDate: borrow.ngayTra ? new Date(borrow.ngayTra).toISOString().split(\"T\")[0] : null,\n      status: borrow.trangThai,\n      notes: borrow.ghiChu || \"\"\n    };\n  };\n\n  // Tải dữ liệu phiếu mượn từ API\n  useEffect(() => {\n    refreshBorrows();\n  }, []);\n\n  // Lọc phiếu mượn khi tìm kiếm\n  useEffect(() => {\n    const filtered = borrows.filter(borrow => borrow.readerName.toLowerCase().includes(searchTerm.toLowerCase()) || borrow.bookTitle.toLowerCase().includes(searchTerm.toLowerCase()) || borrow.status.includes(searchTerm.toLowerCase()));\n    setFilteredBorrows(filtered);\n  }, [searchTerm, borrows]);\n  const handleAddBorrow = () => {\n    setEditingBorrow(null);\n    setShowModal(true);\n  };\n  const handleEditBorrow = borrow => {\n    setEditingBorrow(borrow);\n    setShowModal(true);\n  };\n\n  // Trả sách\n  const handleReturnBook = borrowId => {\n    // Tìm borrow hiện tại\n    const borrow = borrows.find(b => b.id === borrowId);\n    if (!borrow) return;\n\n    // Gửi yêu cầu cập nhật trạng thái lên API\n    fetch(`${apiUrl}/${borrowId}`, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: borrowId,\n        idDocGia: borrow.readerId,\n        idSach: borrow.bookId,\n        ngayMuon: borrow.borrowDate,\n        hanTra: borrow.returnDate,\n        ngayTra: new Date().toISOString().split(\"T\")[0],\n        trangThai: \"returned\",\n        ghiChu: borrow.notes || \"\"\n      })\n    }).then(res => res.json()).then(() => {\n      refreshBorrows();\n    }).catch(err => console.error(\"Lỗi khi trả sách:\", err));\n  };\n\n  // Lưu phiếu mượn\n  const handleSaveBorrow = borrowData => {\n    if (!borrowData.readerId || !borrowData.bookId || !borrowData.borrowDate || !borrowData.returnDate) {\n      alert(\"Vui lòng điền đầy đủ thông tin phiếu mượn.\");\n      return;\n    }\n    if (new Date(borrowData.returnDate) < new Date(borrowData.borrowDate)) {\n      alert(\"Ngày trả không thể trước ngày mượn.\");\n      return;\n    }\n    const requestData = {\n      IdDocGia: borrowData.readerId,\n      TenDocGia: borrowData.readerName,\n      // Thêm dòng này\n      IdSach: borrowData.bookId,\n      TenSach: borrowData.bookTitle,\n      // Thêm dòng này\n      NgayMuon: borrowData.borrowDate,\n      HanTra: borrowData.returnDate,\n      NgayTra: borrowData.actualReturnDate || null,\n      TrangThai: borrowData.status || \"borrowed\",\n      GhiChu: borrowData.notes || \"\"\n    };\n    if (editingBorrow && editingBorrow.id) {\n      // Cập nhật phiếu mượn hiện tại\n      fetch(`${apiUrl}/${editingBorrow.id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          ...requestData,\n          id: editingBorrow.id\n        })\n      }).then(res => res.json()).then(() => {\n        setShowModal(false);\n        setEditingBorrow(null);\n        refreshBorrows();\n      }).catch(err => console.error(\"Lỗi khi cập nhật phiếu mượn:\", err));\n    } else {\n      // Thêm phiếu mượn mới\n      fetch(apiUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(requestData)\n      }).then(res => {\n        if (!res.ok) {\n          res.text().then(text => alert(\"Lỗi khi thêm phiếu mượn: \" + text));\n          return;\n        }\n        return res.json();\n      }).then(() => {\n        setShowModal(false);\n        setEditingBorrow(null);\n        refreshBorrows();\n      }).catch(err => console.error(\"Lỗi khi thêm phiếu mượn:\", err));\n    }\n  };\n  const refreshBorrows = () => {\n    setLoading(true);\n    fetch(apiUrl).then(res => res.json()).then(data => {\n      const mappedBorrows = data.map(mapBorrowData);\n      setBorrows(mappedBorrows);\n      setFilteredBorrows(mappedBorrows);\n      setLoading(false);\n    }).catch(err => {\n      console.error(\"Lỗi khi tải phiếu mượn:\", err);\n      setLoading(false);\n    });\n  };\n  const handleDeleteBorrow = borrowId => {\n    if (window.confirm(\"Bạn có chắc chắn muốn xóa phiếu mượn này?\")) {\n      fetch(`${apiUrl}/${borrowId}`, {\n        method: \"DELETE\"\n      }).then(() => {\n        refreshBorrows();\n      }).catch(err => console.error(\"Lỗi khi xóa phiếu mượn:\", err));\n    }\n  };\n  const getStatusBadge = status => {\n    switch (status) {\n      case \"borrowed\":\n        return /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-info\",\n          children: \"\\u0110ang m\\u01B0\\u1EE3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 16\n        }, this);\n      case \"returned\":\n        return /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-success\",\n          children: \"\\u0110\\xE3 tr\\u1EA3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 16\n        }, this);\n      case \"overdue\":\n        return /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-danger\",\n          children: \"Qu\\xE1 h\\u1EA1n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 16\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-secondary\",\n          children: \"Kh\\xF4ng x\\xE1c \\u0111\\u1ECBnh\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  const isOverdue = returnDate => {\n    return new Date(returnDate) < new Date();\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"borrow-management\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"page-title\",\n        children: \"Qu\\u1EA3n l\\xFD m\\u01B0\\u1EE3n tr\\u1EA3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"page-subtitle\",\n        children: \"Qu\\u1EA3n l\\xFD phi\\u1EBFu m\\u01B0\\u1EE3n tr\\u1EA3 s\\xE1ch trong th\\u01B0 vi\\u1EC7n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"section-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"search-bar\",\n          children: [/*#__PURE__*/_jsxDEV(FaSearch, {\n            className: \"search-icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"T\\xECm ki\\u1EBFm theo t\\xEAn \\u0111\\u1ED9c gi\\u1EA3, t\\xEAn s\\xE1ch ho\\u1EB7c tr\\u1EA1ng th\\xE1i...\",\n            value: searchTerm,\n            onChange: e => setSearchTerm(e.target.value),\n            className: \"search-input\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-primary\",\n          onClick: handleAddBorrow,\n          children: [/*#__PURE__*/_jsxDEV(FaPlus, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 13\n          }, this), \" Th\\xEAm phi\\u1EBFu m\\u01B0\\u1EE3n\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"table-container\",\n        children: /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"M\\xE3 phi\\u1EBFu\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u0110\\u1ED9c gi\\u1EA3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"S\\xE1ch\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Ng\\xE0y m\\u01B0\\u1EE3n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 247,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"H\\u1EA1n tr\\u1EA3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 248,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Ng\\xE0y tr\\u1EA3 th\\u1EF1c\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Tr\\u1EA1ng th\\xE1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Ghi ch\\xFA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Thao t\\xE1c\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: filteredBorrows.map(borrow => /*#__PURE__*/_jsxDEV(\"tr\", {\n              className: isOverdue(borrow.returnDate) && borrow.status === \"borrowed\" ? \"overdue-row\" : \"\",\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: [\"#\", borrow.id.toString().padStart(4, \"0\")]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"borrow-reader\",\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: borrow.readerName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 268,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    children: [\"ID: #\", borrow.readerId]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 269,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 267,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 266,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"borrow-book\",\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: borrow.bookTitle\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 274,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    children: [\"ID: #\", borrow.bookId]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 275,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 273,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: borrow.borrowDate\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 278,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: isOverdue(borrow.returnDate) && borrow.status === \"borrowed\" ? \"overdue-date\" : \"\",\n                children: borrow.returnDate\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: borrow.actualReturnDate || \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 289,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: getStatusBadge(borrow.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 290,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"borrow-notes\",\n                  children: borrow.notes || \"Không có ghi chú\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 292,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 291,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"action-buttons\",\n                  children: [borrow.status === \"borrowed\" && /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-success btn-sm\",\n                    onClick: () => handleReturnBook(borrow.id),\n                    title: \"Tr\\u1EA3 s\\xE1ch\",\n                    children: /*#__PURE__*/_jsxDEV(FaCheck, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 304,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 299,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-secondary btn-sm\",\n                    onClick: () => handleEditBorrow(borrow),\n                    title: \"Ch\\u1EC9nh s\\u1EEDa\",\n                    children: /*#__PURE__*/_jsxDEV(FaEdit, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 312,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 307,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-danger btn-sm\",\n                    onClick: () => handleDeleteBorrow(borrow.id),\n                    title: \"X\\xF3a\",\n                    children: /*#__PURE__*/_jsxDEV(FaTrash, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 319,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 314,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 297,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 296,\n                columnNumber: 19\n              }, this)]\n            }, borrow.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this), filteredBorrows.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"empty-state\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Kh\\xF4ng t\\xECm th\\u1EA5y phi\\u1EBFu m\\u01B0\\u1EE3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Kh\\xF4ng c\\xF3 phi\\u1EBFu m\\u01B0\\u1EE3n n\\xE0o ph\\xF9 h\\u1EE3p v\\u1EDBi t\\u1EEB kh\\xF3a t\\xECm ki\\u1EBFm.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this), showModal && /*#__PURE__*/_jsxDEV(BorrowModal, {\n      borrow: editingBorrow,\n      onSave: handleSaveBorrow,\n      onClose: () => {\n        setShowModal(false);\n        setEditingBorrow(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 5\n  }, this);\n};\n_s(BorrowManagement, \"5RfCFmJDrtX2BRydEMpK7+mqsss=\");\n_c = BorrowManagement;\nexport default BorrowManagement;\nvar _c;\n$RefreshReg$(_c, \"BorrowManagement\");","map":{"version":3,"names":["React","useState","useEffect","FaPlus","FaSearch","FaEdit","FaTrash","FaCheck","FaTimes","BorrowModal","jsxDEV","_jsxDEV","BorrowManagement","_s","borrows","setBorrows","filteredBorrows","setFilteredBorrows","searchTerm","setSearchTerm","showModal","setShowModal","editingBorrow","setEditingBorrow","loading","setLoading","apiUrl","mapBorrowData","borrow","_borrow$docGia","_borrow$sach","id","readerId","idDocGia","readerName","docGia","tenDocGia","bookId","idSach","bookTitle","sach","tenSach","borrowDate","Date","ngayMuon","toISOString","split","returnDate","hanTra","actualReturnDate","ngayTra","status","trangThai","notes","ghiChu","refreshBorrows","filtered","filter","toLowerCase","includes","handleAddBorrow","handleEditBorrow","handleReturnBook","borrowId","find","b","fetch","method","headers","body","JSON","stringify","then","res","json","catch","err","console","error","handleSaveBorrow","borrowData","alert","requestData","IdDocGia","TenDocGia","IdSach","TenSach","NgayMuon","HanTra","NgayTra","TrangThai","GhiChu","ok","text","data","mappedBorrows","map","handleDeleteBorrow","window","confirm","getStatusBadge","className","children","fileName","_jsxFileName","lineNumber","columnNumber","isOverdue","type","placeholder","value","onChange","e","target","onClick","toString","padStart","title","length","onSave","onClose","_c","$RefreshReg$"],"sources":["C:/Users/lepha/Desktop/CNPM-Project/QuanLyThuVien_Web/src/pages/BorrowManagement.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  FaPlus,\r\n  FaSearch,\r\n  FaEdit,\r\n  FaTrash,\r\n  FaCheck,\r\n  FaTimes,\r\n} from \"react-icons/fa\";\r\nimport BorrowModal from \"../components/BorrowModal\";\r\nimport \"./BorrowManagement.css\";\r\n\r\nconst BorrowManagement = () => {\r\n  const [borrows, setBorrows] = useState([]);\r\n  const [filteredBorrows, setFilteredBorrows] = useState([]);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingBorrow, setEditingBorrow] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const apiUrl =\r\n    \"http://localhost:5280/api/PhieuMuon\";\r\n\r\n  const mapBorrowData = (borrow) => ({\r\n    id: borrow.id,\r\n    readerId: borrow.idDocGia,\r\n    readerName: borrow.docGia?.tenDocGia || borrow.tenDocGia || \"\",\r\n    bookId: borrow.idSach,\r\n    bookTitle: borrow.sach?.tenSach || borrow.tenSach || \"\",\r\n    borrowDate: new Date(borrow.ngayMuon).toISOString().split(\"T\")[0],\r\n    returnDate: new Date(borrow.hanTra).toISOString().split(\"T\")[0],\r\n    actualReturnDate: borrow.ngayTra\r\n      ? new Date(borrow.ngayTra).toISOString().split(\"T\")[0]\r\n      : null,\r\n    status: borrow.trangThai,\r\n    notes: borrow.ghiChu || \"\",\r\n  });\r\n\r\n  // Tải dữ liệu phiếu mượn từ API\r\n  useEffect(() => {\r\n    refreshBorrows();\r\n  }, []);\r\n\r\n  // Lọc phiếu mượn khi tìm kiếm\r\n  useEffect(() => {\r\n    const filtered = borrows.filter(\r\n      (borrow) =>\r\n        borrow.readerName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        borrow.bookTitle.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        borrow.status.includes(searchTerm.toLowerCase())\r\n    );\r\n    setFilteredBorrows(filtered);\r\n  }, [searchTerm, borrows]);\r\n\r\n  const handleAddBorrow = () => {\r\n    setEditingBorrow(null);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleEditBorrow = (borrow) => {\r\n    setEditingBorrow(borrow);\r\n    setShowModal(true);\r\n  };\r\n\r\n  // Trả sách\r\n  const handleReturnBook = (borrowId) => {\r\n    // Tìm borrow hiện tại\r\n    const borrow = borrows.find((b) => b.id === borrowId);\r\n    if (!borrow) return;\r\n\r\n    // Gửi yêu cầu cập nhật trạng thái lên API\r\n    fetch(`${apiUrl}/${borrowId}`, {\r\n      method: \"PUT\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        id: borrowId,\r\n        idDocGia: borrow.readerId,\r\n        idSach: borrow.bookId,\r\n        ngayMuon: borrow.borrowDate,\r\n        hanTra: borrow.returnDate,\r\n        ngayTra: new Date().toISOString().split(\"T\")[0],\r\n        trangThai: \"returned\",\r\n        ghiChu: borrow.notes || \"\",\r\n      }),\r\n    })\r\n      .then((res) => res.json())\r\n      .then(() => {\r\n        refreshBorrows();\r\n      })\r\n      .catch((err) => console.error(\"Lỗi khi trả sách:\", err));\r\n  };\r\n\r\n  // Lưu phiếu mượn\r\n  const handleSaveBorrow = (borrowData) => {\r\n    if (\r\n      !borrowData.readerId ||\r\n      !borrowData.bookId ||\r\n      !borrowData.borrowDate ||\r\n      !borrowData.returnDate\r\n    ) {\r\n      alert(\"Vui lòng điền đầy đủ thông tin phiếu mượn.\");\r\n      return;\r\n    }\r\n\r\n    if (new Date(borrowData.returnDate) < new Date(borrowData.borrowDate)) {\r\n      alert(\"Ngày trả không thể trước ngày mượn.\");\r\n      return;\r\n    }\r\n\r\n    const requestData = {\r\n      IdDocGia: borrowData.readerId,\r\n      TenDocGia: borrowData.readerName, // Thêm dòng này\r\n      IdSach: borrowData.bookId,\r\n      TenSach: borrowData.bookTitle, // Thêm dòng này\r\n      NgayMuon: borrowData.borrowDate,\r\n      HanTra: borrowData.returnDate,\r\n      NgayTra: borrowData.actualReturnDate || null,\r\n      TrangThai: borrowData.status || \"borrowed\",\r\n      GhiChu: borrowData.notes || \"\",\r\n    };\r\n\r\n    if (editingBorrow && editingBorrow.id) {\r\n      // Cập nhật phiếu mượn hiện tại\r\n      fetch(`${apiUrl}/${editingBorrow.id}`, {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ ...requestData, id: editingBorrow.id }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then(() => {\r\n          setShowModal(false);\r\n          setEditingBorrow(null);\r\n          refreshBorrows();\r\n        })\r\n        .catch((err) => console.error(\"Lỗi khi cập nhật phiếu mượn:\", err));\r\n    } else {\r\n      // Thêm phiếu mượn mới\r\n      fetch(apiUrl, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(requestData),\r\n      })\r\n        .then((res) => {\r\n          if (!res.ok) {\r\n            res\r\n              .text()\r\n              .then((text) => alert(\"Lỗi khi thêm phiếu mượn: \" + text));\r\n            return;\r\n          }\r\n          return res.json();\r\n        })\r\n        .then(() => {\r\n          setShowModal(false);\r\n          setEditingBorrow(null);\r\n          refreshBorrows();\r\n        })\r\n        .catch((err) => console.error(\"Lỗi khi thêm phiếu mượn:\", err));\r\n    }\r\n  };\r\n\r\n  const refreshBorrows = () => {\r\n    setLoading(true);\r\n    fetch(apiUrl)\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        const mappedBorrows = data.map(mapBorrowData);\r\n        setBorrows(mappedBorrows);\r\n        setFilteredBorrows(mappedBorrows);\r\n        setLoading(false);\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Lỗi khi tải phiếu mượn:\", err);\r\n        setLoading(false);\r\n      });\r\n  };\r\n\r\n  const handleDeleteBorrow = (borrowId) => {\r\n    if (window.confirm(\"Bạn có chắc chắn muốn xóa phiếu mượn này?\")) {\r\n      fetch(`${apiUrl}/${borrowId}`, {\r\n        method: \"DELETE\",\r\n      })\r\n        .then(() => {\r\n          refreshBorrows();\r\n        })\r\n        .catch((err) => console.error(\"Lỗi khi xóa phiếu mượn:\", err));\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    switch (status) {\r\n      case \"borrowed\":\r\n        return <span className=\"badge badge-info\">Đang mượn</span>;\r\n      case \"returned\":\r\n        return <span className=\"badge badge-success\">Đã trả</span>;\r\n      case \"overdue\":\r\n        return <span className=\"badge badge-danger\">Quá hạn</span>;\r\n      default:\r\n        return <span className=\"badge badge-secondary\">Không xác định</span>;\r\n    }\r\n  };\r\n\r\n  const isOverdue = (returnDate) => {\r\n    return new Date(returnDate) < new Date();\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading\">\r\n        <div className=\"spinner\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"borrow-management\">\r\n      <div className=\"page-header\">\r\n        <h1 className=\"page-title\">Quản lý mượn trả</h1>\r\n        <p className=\"page-subtitle\">\r\n          Quản lý phiếu mượn trả sách trong thư viện\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"content-section\">\r\n        <div className=\"section-header\">\r\n          <div className=\"search-bar\">\r\n            <FaSearch className=\"search-icon\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Tìm kiếm theo tên độc giả, tên sách hoặc trạng thái...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"search-input\"\r\n            />\r\n          </div>\r\n          <button className=\"btn btn-primary\" onClick={handleAddBorrow}>\r\n            <FaPlus /> Thêm phiếu mượn\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"table-container\">\r\n          <table className=\"table\">\r\n            <thead>\r\n              <tr>\r\n                <th>Mã phiếu</th>\r\n                <th>Độc giả</th>\r\n                <th>Sách</th>\r\n                <th>Ngày mượn</th>\r\n                <th>Hạn trả</th>\r\n                <th>Ngày trả thực</th>\r\n                <th>Trạng thái</th>\r\n                <th>Ghi chú</th>\r\n                <th>Thao tác</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filteredBorrows.map((borrow) => (\r\n                <tr\r\n                  key={borrow.id}\r\n                  className={\r\n                    isOverdue(borrow.returnDate) && borrow.status === \"borrowed\"\r\n                      ? \"overdue-row\"\r\n                      : \"\"\r\n                  }\r\n                >\r\n                  <td>#{borrow.id.toString().padStart(4, \"0\")}</td>\r\n                  <td>\r\n                    <div className=\"borrow-reader\">\r\n                      <strong>{borrow.readerName}</strong>\r\n                      <small>ID: #{borrow.readerId}</small>\r\n                    </div>\r\n                  </td>\r\n                  <td>\r\n                    <div className=\"borrow-book\">\r\n                      <strong>{borrow.bookTitle}</strong>\r\n                      <small>ID: #{borrow.bookId}</small>\r\n                    </div>\r\n                  </td>\r\n                  <td>{borrow.borrowDate}</td>\r\n                  <td\r\n                    className={\r\n                      isOverdue(borrow.returnDate) &&\r\n                      borrow.status === \"borrowed\"\r\n                        ? \"overdue-date\"\r\n                        : \"\"\r\n                    }\r\n                  >\r\n                    {borrow.returnDate}\r\n                  </td>\r\n                  <td>{borrow.actualReturnDate || \"-\"}</td>\r\n                  <td>{getStatusBadge(borrow.status)}</td>\r\n                  <td>\r\n                    <div className=\"borrow-notes\">\r\n                      {borrow.notes || \"Không có ghi chú\"}\r\n                    </div>\r\n                  </td>\r\n                  <td>\r\n                    <div className=\"action-buttons\">\r\n                      {borrow.status === \"borrowed\" && (\r\n                        <button\r\n                          className=\"btn btn-success btn-sm\"\r\n                          onClick={() => handleReturnBook(borrow.id)}\r\n                          title=\"Trả sách\"\r\n                        >\r\n                          <FaCheck />\r\n                        </button>\r\n                      )}\r\n                      <button\r\n                        className=\"btn btn-secondary btn-sm\"\r\n                        onClick={() => handleEditBorrow(borrow)}\r\n                        title=\"Chỉnh sửa\"\r\n                      >\r\n                        <FaEdit />\r\n                      </button>\r\n                      <button\r\n                        className=\"btn btn-danger btn-sm\"\r\n                        onClick={() => handleDeleteBorrow(borrow.id)}\r\n                        title=\"Xóa\"\r\n                      >\r\n                        <FaTrash />\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {filteredBorrows.length === 0 && (\r\n          <div className=\"empty-state\">\r\n            <h3>Không tìm thấy phiếu mượn</h3>\r\n            <p>Không có phiếu mượn nào phù hợp với từ khóa tìm kiếm.</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {showModal && (\r\n        <BorrowModal\r\n          borrow={editingBorrow}\r\n          onSave={handleSaveBorrow}\r\n          onClose={() => {\r\n            setShowModal(false);\r\n            setEditingBorrow(null);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BorrowManagement;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}